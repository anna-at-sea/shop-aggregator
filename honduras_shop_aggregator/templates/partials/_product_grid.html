{% load i18n %}

<div id="product-list">
{% if products %}
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-3 gy-4 justify-content-start mb-4">
    {% for product in products %}
    <div class="col d-flex justify-content-center position-relative">
        <div class="card shadow-sm p-2 card-hover" style="width: 100%; max-width: 320px;">
            {% csrf_token %}
            <button class="btn like-btn position-absolute top-0 end-0 m-2" style="z-index: 10;" data-product-id="{{ product.pk }}">
                {% if user.is_authenticated and product.is_liked %}
                ‚ù§Ô∏è
                {% else %}
                    {% if request.session.liked_products and product.pk in request.session.liked_products %}
                    ‚ù§Ô∏è
                    {% else %}
                    ü§ç
                    {% endif %}
                {% endif %}
            </button>
            <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.product_name }}" style="max-height: 300px; object-fit: contain;">
            {% if not product.stock_quantity or not product.is_active or product.is_deleted %}
            <div class="unavailable-overlay">{% translate "Not available" %}</div>
            {% endif %}
            <div class="card-body">
                <h5 class="card-title mb-2 fw-semibold text-dark product-name">{{ product.product_name }}</h5>
                <a href="{% url 'product_card' product.slug %}" class="text-decoration-none text-dark stretched-link"></a>
                <p class="card-text mb-1">
                    {% if not product.stock_quantity or not product.is_active or product.is_deleted %}
                    <span class="fs-5 fw-bold text-dark">{% translate "Product not available" %}</span>
                    {% else %}
                    <span class="fs-5 fw-bold text-dark">L{{ product.product_price }}</span>
                    {% endif %}
                </p>
                {% if user.is_authenticated and user == product.seller.user and seller_features_enabled %}
                <strong>{% translate "Stock" %}:</strong> {{ product.stock_quantity }}<br>
                <strong>{% translate "Active" %}:</strong> 
                    {% if product.is_active %}
                        <span class="text-success">{% translate "Yes" %}</span>
                    {% else %}
                        <span class="text-danger">{% translate "No" %}</span>
                    {% endif %}
                <br>
                <strong>{% translate "Saved" %}:</strong> {{ product.likes.all.count }}
                <br>
                <a href="{% url 'product_update' product.slug %}" class="btn btn-danger btn-sm mt-2">{% translate "Edit Product Info" %}</a>
                {% else %}
                <p class="card-text mb-0 text-muted small seller-name">
                    {% translate "Sold by" %}: <span class="fw-medium text-secondary">{{ product.seller }}</span>
                </p>
                <p class="card-text mb-0 text-muted small">
                    {% if not product.stock_quantity or not product.is_active or product.is_deleted %}{% else %}
                        {% if current_city == product.origin_city %}
                            <span class="text-success">{% translate "Available in your city" %}</span>
                        {% else %}
                            {% if current_city in product.delivery_cities.all %}
                                <span class="text-success">{% translate "Delivery from" %} {{ product.origin_city.name }}</span>
                            {% else %}
                                <span class="text-danger">{% translate "Not available in your city" %}</span>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info mt-3">
    {% translate "No products found." %}
</div>
{% endif %}
</div>
